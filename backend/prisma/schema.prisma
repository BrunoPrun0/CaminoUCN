generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  id            Int         @id @default(autoincrement())
  apiStudentId  String      @unique  // Este sería el RUT
  name          String?
  email         String?
  careerCode    String?     // Código de carrera
  catalogCode   String?     // Catálogo
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  projections   Projection[]

  @@map("students")
}

model Projection {
  id            Int      @id @default(autoincrement())
  studentId     Int
  careerCode    String   // Código de la carrera 
  catalogCode   String   // Código del catálogo 
  name          String   // Nombre de la proyección 
  isFavorite    Boolean  @default(false)
  isAutomatic   Boolean  @default(false) // true si es proyección automática
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  student       Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  courses       ProjectionCourse[]

  @@unique([studentId, careerCode, name]) // No puede haber dos proyecciones con el mismo nombre en la misma carrera
  @@index([studentId, careerCode]) // Para filtrar por estudiante y carrera
  @@map("projections")
}

model ProjectionCourse {
  id            Int      @id @default(autoincrement())
  projectionId  Int
  courseApiId   String   // Código del curso 
  courseName     String?
  semesterNumber Int     // Número de semestre en la proyección 
  credits       Int      // Créditos del curso (para cálculos rápidos)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  projection    Projection @relation(fields: [projectionId], references: [id], onDelete: Cascade)

  @@unique([projectionId, courseApiId]) // Un curso no puede estar duplicado en la misma proyección
  @@index([projectionId, semesterNumber]) // Para consultas por semestre
  @@map("projection_courses")
}

// migracion
// 1. npx prisma migrate dev --name add_semester_to_projections
